<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gobelin Students – Logement Festival Annecy</title>

<style>
:root {
  --primary: #5b7cfa;
  --soft: #f3f6ff;
  --text: #1f2937;
  --muted: #6b7280;
  --card: #ffffff;
  --radius: 18px;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: Inter, system-ui, Arial, sans-serif;
  background: #fbfcff;
  color: var(--text);
}

/* HEADER */
header {
  text-align: center;
  padding: 3.5rem 1.5rem 3rem;
  background: linear-gradient(180deg, var(--soft), #ffffff);
}

h1 {
  margin-bottom: .5rem;
}

header p {
  color: var(--muted);
  max-width: 520px;
  margin: 0 auto;
}

.lang-switch {
  margin-top: 1.2rem;
}

button, a {
  cursor: pointer;
  border: none;
  border-radius: 999px;
  padding: .8rem 1.4rem;
  font-size: .95rem;
}

.main-btn {
  background: var(--primary);
  color: white;
  margin-top: 2rem;
  display: inline-block;
  text-decoration: none;
}

.lang-switch button {
  background: transparent;
  border: 1px solid var(--primary);
  color: var(--primary);
  margin: 0 .2rem;
}

/* MAIN */
section {
  max-width: 1000px;
  margin: auto;
  padding: 3rem 1.5rem;
}

.filters {
  display: flex;
  gap: .7rem;
  flex-wrap: wrap;
  justify-content: center;
  margin-bottom: 2rem;
}

select {
  padding: .6rem 1.2rem;
  border-radius: 999px;
  border: 1px solid #e5e7eb;
}

/* CARDS */
#cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
  gap: 1.2rem;
}

.card {
  background: var(--card);
  border-radius: var(--radius);
  padding: 1.2rem;
  box-shadow: 0 8px 24px rgba(0,0,0,.05);
  cursor: pointer;
  transition: transform .15s ease;
}

.card:hover {
  transform: translateY(-3px);
}

.card h3 {
  margin: 0 0 .3rem;
}

.card p {
  margin: .2rem 0;
  color: var(--muted);
  font-size: .9rem;
}

/* DETAIL VIEW */
#detail {
  display: none;
}

.detail-card {
  background: white;
  border-radius: var(--radius);
  padding: 2rem;
  box-shadow: 0 15px 40px rgba(0,0,0,.08);
}

.back-btn {
  margin-bottom: 1.5rem;
  background: transparent;
  color: var(--primary);
  border: 1px solid var(--primary);
}
</style>
</head>

<body>

<header>
  <h1 data-fr="Logement étudiant – Festival d’Annecy"
      data-en="Student Housing – Annecy Festival"></h1>

  <p data-fr="Plateforme solidaire entre étudiants Gobelins"
     data-en="A solidarity platform for Gobelins students"></p>

  <div class="lang-switch">
    <button onclick="setLang('fr')">FR</button>
    <button onclick="setLang('en')">EN</button>
  </div>

  <a class="main-btn"
     target="_blank"
     href="https://docs.google.com/forms/d/e/1FAIpQLSdnaTixbqudAQtLW9kk971NHRx2rfAjYjq5SrwV59T-Cq8U_Q/viewform?usp=header"
     data-fr="Faire une demande / proposer un logement"
     data-en="Submit a request / offer accommodation">
  </a>
</header>

<section>

<h2 data-fr="Demandes et propositions de logement déjà en ligne"
    data-en="Housing requests and offers already online"></h2>

<div class="filters">
  <select id="categoryFilter">
    <option value="">Catégorie</option>
    <option value="search">Cherche</option>
    <option value="offer">Propose</option>
  </select>
</div>

<div id="cards"></div>
<div id="detail"></div>

</section>

<script>
/* ---------------- LANGUE ---------------- */

let currentLang = "fr";

function setLang(lang) {
  currentLang = lang;
  document.querySelectorAll("[data-fr]").forEach(el => {
    el.textContent = el.dataset[lang];
  });
}

document.addEventListener("DOMContentLoaded", () => {
  setLang("fr");
});

/* ---------------- DATA ---------------- */

const SHEET_URL =
"https://opensheet.elk.sh/17cmcjMuD7BKdJskOvEYoPY2s7LnSVIENWeu2whUCJKY/Réponses%20au%20formulaire%201";

let allData = [];

fetch(SHEET_URL)
  .then(res => res.json())
  .then(data => {
    allData = data;
    renderCards(data);
  });

/* ---------------- HELPERS ---------------- */

function email(item) {
  return item["Adresse mail Gobelins"] || item["Gobelin email"] || "";
}

function category(item) {
  if (item.Catégorie?.toLowerCase().includes("cherche") || item.Category?.includes("Looking"))
    return "search";
  if (item.Catégorie?.toLowerCase().includes("propose") || item.Category?.includes("Offering"))
    return "offer";
  return "";
}

/* ---------------- CARDS LIST ---------------- */

function renderCards(data) {
  const container = document.getElementById("cards");
  container.innerHTML = "";
  document.getElementById("detail").style.display = "none";
  container.style.display = "grid";

  data.forEach(item => {
    if (!email(item).endsWith("@edu.gobelins.fr")) return;

    const card = document.createElement("div");
    card.className = "card";

    const first = item.Prénom || item.Name || "";
    const last = item.NOM || item.LASTNAME || "";
    const gender = item.Genre || item.Gender || "";

    card.innerHTML = `
      <h3>${first} ${last}</h3>
      <p>${gender}</p>
      <p>${category(item) === "search" ? "Cherche un logement" : "Propose un logement"}</p>
    `;

    card.onclick = () => openDetail(item);
    container.appendChild(card);
  });
}

/* ---------------- DETAIL VIEW ---------------- */

function openDetail(item) {
  document.getElementById("cards").style.display = "none";
  const detail = document.getElementById("detail");
  detail.style.display = "block";

  detail.innerHTML = `
    <button class="back-btn" onclick="renderCards(allData)">← Retour aux annonces</button>

    <div class="detail-card">
      <h2>${item.Prénom || item.Name} ${item.NOM || item.LASTNAME}</h2>

      <p><strong>Type :</strong> ${category(item)}</p>
      <p><strong>Genre :</strong> ${item.Genre || item.Gender}</p>
      <p><strong>Langues :</strong> ${item["Langues parlées"] || item["Languages spoken"]}</p>
      <p><strong>Dates :</strong> ${item["Dates de disponibilité / recherche"] || item["Dates available"]}</p>
      <p><strong>Places :</strong> ${item["Nombre de places disponibles / recherchées"] || item["Number of places available / needed"]}</p>
      <p><strong>Email :</strong> ${email(item)}</p>
      <p><strong>Contact :</strong> ${item["Contact (autre mail/insta/numéro)"] || item["Contact (personnal email/instagram/phone number)"] || "-"}</p>
      <p><strong>Commentaire :</strong> ${item["Commentaire / Précisions"] || item["Comment / details"] || "-"}</p>
    </div>
  `;
}

/* ---------------- FILTER ---------------- */

categoryFilter.onchange = () => {
  const val = categoryFilter.value;
  renderCards(val ? allData.filter(i => category(i) === val) : allData);
};
</script>

</body>
</html>
