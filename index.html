<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gobelins Students ‚Äì Logement Festival Annecy</title>
<link rel="stylesheet" href="style.css">
<style>
/* ---------------- PAGE MAIL ---------------- */
#gate {position:fixed; inset:0; background:#e6ebff; display:flex; align-items:center; justify-content:center; text-align:center; z-index:9999;}
.gate-card{background:#fff; padding:50px 35px; border-radius:25px; max-width:450px; width:90%; box-shadow:0 20px 40px rgba(0,0,0,0.08); display:flex; flex-direction:column; align-items:center;}
.gate-card h2{font-size:1.5em;font-weight:700;color:#3b3b3b;margin-bottom:15px;line-height:1.3;}
.gate-card p{font-size:1em;color:#5b5b5b;margin-bottom:25px;}
.gate-card input{width:100%; padding:14px; border-radius:12px; border:1px solid #b8b8b8; font-size:1em; margin-bottom:15px;}
.gate-card input:focus{outline:none;border-color:#6c7cff;}
#okBtn{padding:12px 25px; border:none; border-radius:12px; background:#6c7cff;color:white;font-weight:600;font-size:1em;margin-bottom:15px;}
#okBtn:hover{background:#5664e0;}
.lang-inline{display:flex; gap:12px; margin-top:25px;}
.lang-inline button{padding:5px 20px; font-size:0.85em; border-radius:12px; border:2px solid #6c7cff; background:#c6ccff; color:#6c7cff;}
.lang-inline button:hover{background:#aab8ff;}
#gateError{color:#d33; font-weight:500; margin-top:12px;}
</style>
</head>
<body>

<!-- ---------------- PAGE MAIL ---------------- -->
<div id="gate">
  <div class="gate-card">
    <h2 id="welcomeText" data-fr="Bienvenue sur la plateforme de logement Festival Annecy ‚Äì R√©serv√©e aux √©tudiants Gobelins"
                    data-en="Welcome to the Annecy Festival Student Housing Platform ‚Äì Gobelins students only">
    </h2>
    <p id="instructionText" data-fr="Pour acc√©der au site, veuillez entrer votre adresse mail Gobelins"
                            data-en="To access the site, please enter your Gobelins email">
    </p>
    <input type="email" id="gateEmail" placeholder="">
    <button id="okBtn" onclick="checkGate()">OK</button>
    <div class="lang-inline">
      <button onclick="setLang('fr')">FR</button>
      <button onclick="setLang('en')">EN</button>
    </div>
    <p id="gateError"></p>
  </div>
</div>

<!-- ---------------- SITE ---------------- -->
<div id="mainContent" style="display:none">

<header>
  <h1 data-fr="Logement √©tudiant ‚Äì Festival d‚ÄôAnnecy"
      data-en="Student Housing ‚Äì Annecy Festival"></h1>
  <p data-fr="Plateforme solidaire entre √©tudiants Gobelins"
     data-en="A solidarity platform for Gobelins students"></p>
  <div class="lang-switch">
    <button onclick="setLang('fr')">FR</button>
    <button onclick="setLang('en')">EN</button>
  </div>
  <a class="main-btn"
     target="_blank"
     href="https://docs.google.com/forms/d/e/1FAIpQLSdnaTixbqudAQtLW9kk971NHRx2rfAjYjq5SrwV59T-Cq8U_Q/viewform?usp=header"
     data-fr="Faire une demande / proposer un logement"
     data-en="Submit a request / offer accommodation">
  </a>
</header>

<section>
<h2 data-fr="Demandes et propositions de logement"
    data-en="Housing requests and offers"></h2>

<div class="filters">
  <select id="categoryFilter">
    <option value="" data-fr="Cat√©gorie" data-en="Category"></option>
    <option value="search" data-fr="Cherche" data-en="Looking"></option>
    <option value="offer" data-fr="Propose" data-en="Offering"></option>
  </select>

  <select id="placesFilter">
    <option value="" data-fr="Nombre de places" data-en="Number of places"></option>
    <option value="1">1</option>
    <option value="2">2</option>
    <option value="3+">3+</option>
  </select>

  <select id="langFilter">
    <option value="" data-fr="Langues parl√©es" data-en="Languages spoken"></option>
    <option value="fr">FR</option>
    <option value="en">EN</option>
    <option value="both">FR+EN</option>
  </select>
</div>

<div id="cards"></div>
<div id="detail"></div>

</section>
</div>

<script>
/* ---------------- LANG ---------------- */
let currentLang="fr";
function setLang(lang){
  currentLang=lang;
  document.querySelectorAll("[data-fr]").forEach(el=>{
    el.textContent = el.dataset[lang] || el.dataset.fr;
  });
  renderFilters();
  renderCards(allData);
}

/* ---------------- GATE ---------------- */
function checkGate(){
  const emailInput=document.getElementById("gateEmail").value.trim();
  const error=document.getElementById("gateError");
  if(!emailInput.endsWith("@edu.gobelins.fr")){
    error.textContent = currentLang==="fr"?"Adresse Gobelins invalide":"Invalid Gobelins email";
    return;
  }
  localStorage.setItem("gobelinsAccess", emailInput);
  document.getElementById("gate").style.display="none";
  showSite();
}

function showSite(){
  document.getElementById("mainContent").style.display="block";
  loadData();
}

window.addEventListener("DOMContentLoaded",()=>{
  const saved=localStorage.getItem("gobelinsAccess");
  if(saved && saved.endsWith("@edu.gobelins.fr")){
    document.getElementById("gate").style.display="none";
    showSite();
  }
  setLang('fr'); // par d√©faut FR
});

/* ---------------- DATA ---------------- */
const SHEET_URL = "https://opensheet.elk.sh/17cmcjMuD7BKdJskOvEYoPY2s7LnSVIENWeu2whUCJKY/R√©ponses%20au%20formulaire%201";
let allData = [];

function loadData(){
  fetch(SHEET_URL)
  .then(res=>res.json())
  .then(data=>{
    allData = data;
    renderFilters();
    renderCards(allData);
  });
}

/* ---------------- HELPERS ---------------- */
function email(item){ return item["Adresse mail Gobelins"] || item["Gobelin email"] || ""; }
function category(item){
  if(item.Cat√©gorie?.toLowerCase().includes("cherche") || item.Category?.includes("Looking")) return "search";
  if(item.Cat√©gorie?.toLowerCase().includes("propose") || item.Category?.includes("Offering")) return "offer";
  return "";
}
function getPlaces(item){
  return item["Nombre de places disponibles / recherch√©es"] || item["Number of places available / needed"] || "-";
}
function getDates(item){
  return item["Dates de disponibilit√© / recherche"] || item["Dates available"] || "-";
}
function getLangs(item){
  return item["Langues parl√©es"] || item["Languages spoken"] || "-";
}
function parseLangs(item){
  const raw = getLangs(item);
  if(!raw) return [];
  const l = raw.toLowerCase();
  const langs = [];
  if(l.includes("fr") || l.includes("fran√ßais")) langs.push("fr");
  if(l.includes("en") || l.includes("anglais")) langs.push("en");
  return langs;
}

/* ---------------- FILTER ---------------- */
function renderFilters(){
  const categoryFilter = document.getElementById("categoryFilter");
  const placesFilter = document.getElementById("placesFilter");
  const langFilter = document.getElementById("langFilter");
  [categoryFilter, placesFilter, langFilter].forEach(sel=>{
    sel.querySelectorAll("option").forEach(opt=>{
      if(opt.dataset[currentLang]) opt.textContent = opt.dataset[currentLang];
    });
  });
}

document.getElementById("categoryFilter").onchange =
document.getElementById("placesFilter").onchange =
document.getElementById("langFilter").onchange = () => {
  applyFilters();
};

function applyFilters(){
  const cat = document.getElementById("categoryFilter").value;
  const places = document.getElementById("placesFilter").value;
  const lang = document.getElementById("langFilter").value;

  const filtered = allData.filter(item=>{
    if(!email(item).endsWith("@edu.gobelins.fr")) return false;
    let keep = true;

    if(cat) keep = keep && category(item)===cat;

    if(places){
      const p = getPlaces(item);
      if(places==="3+") keep = keep && p>=3;
      else keep = keep && p==places;
    }

    if(lang){
      const langs = parseLangs(item);
      if(lang==="fr") keep = keep && langs.includes("fr");
      if(lang==="en") keep = keep && langs.includes("en");
      if(lang==="both") keep = keep && langs.includes("fr") && langs.includes("en");
    }

    return keep;
  });

  renderCards(filtered);
}

/* ---------------- CARDS ---------------- */
function renderCards(data){
  const container = document.getElementById("cards");
  container.innerHTML = "";
  document.getElementById("detail").style.display = "none";
  container.style.display = "grid";

  data.forEach(item=>{
    const first = item.Pr√©nom || item.Name || "";
    const last = item.NOM || item.LASTNAME || "";
    const typeLabel = category(item) === "search"
      ? (currentLang==="fr"?"Cherche un logement":"Looking for accommodation")
      : (currentLang==="fr"?"Propose un logement":"Offering accommodation");
    const places = getPlaces(item);
    const dates = getDates(item);
    const gobelinsEmail = email(item);

    const card = document.createElement("div");
    card.className="card";
    card.innerHTML = `
      <h3>${first} ${last}</h3>
      <p><strong>${typeLabel}</strong></p>
      <p>üõèÔ∏è ${places}</p>
      <p>üìÖ ${dates}</p>
      <p>‚úâÔ∏è ${gobelinsEmail}</p>
    `;

    card.onclick = ()=> openDetail(item);
    container.appendChild(card);
  });
}

/* ---------------- DETAIL VIEW ---------------- */
function openDetail(item){
  document.getElementById("cards").style.display="none";
  const detail = document.getElementById("detail");
  detail.style.display="block";

  const gobelinsEmail = email(item);

  detail.innerHTML=`
    <button class="back-btn" onclick="renderCards(allData)">‚Üê Retour aux annonces</button>
    <div class="detail-card">
      <h2>${item.Pr√©nom || item.Name} ${item.NOM || item.LASTNAME}</h2>
      <p><strong>Type :</strong> ${category(item)==="search" ? (currentLang==="fr"?"Cherche un logement":"Looking for accommodation") : (currentLang==="fr"?"Propose un logement":"Offering accommodation")}</p>
      <p><strong>Genre :</strong> ${item.Genre || item.Gender || "-"}</p>
      <p><strong>Langues :</strong> ${getLangs(item)}</p>
      <p><strong>Dates :</strong> ${getDates(item)}</p>
      <p><strong>Places :</strong> ${getPlaces(item)}</p>
      <p><strong>Email :</strong> ${gobelinsEmail}</p>
      <p><strong>Contact :</strong> ${item["Contact (autre mail/insta/num√©ro)"] || item["Contact (personnal email/instagram/phone number)"] || "-"}</p>
      <p><strong>Commentaire :</strong> ${item["Commentaire / Pr√©cisions"] || item["Comment / details"] || "-"}</p>
    </div>
  `;
}
</script>
</body>
</html>
